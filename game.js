function BlockMgr(e,i,t){this._winHeight=i,this._winWidth=e,this._layer=t,this._mgr=[]}var Block=cc.LayerColor.extend({ctor:function(e,i,t,n,c){return this._super(cc.color(255,0,0,255),t,n),this.x=e,this.y=i,this.width=t,this.point=1,!0},pullPoint:function(){var e=this.point;return this.point=0,e},update:function(){return this.x-=2,this.x+this.width<0?(console.log("claen!"),this.removeFromParent(!0),!0):void 0}});BlockMgr.prototype={init:function(){this.add()},add:function(){var e=this._winHeight/7*2,i=this._winHeight/7*4,t=Math.random()*(i-e)+e,n=t+130,c=new Block(this._winWidth,0,30,t);this._mgr.push(c),this._layer.addChild(c),c=new Block(this._winWidth,n,30,this._winHeight-n),this._mgr.push(c),this._layer.addChild(c)},update:function(e){for(var i=e.getBoundingBox(),t=0;t<this._mgr.length;){var n=this._mgr[t].update(),c=this._mgr[t].getBoundingBox();cc.rectIntersectsRect(i,c)&&e.gameOver(),e.x>this._mgr[t].x&&e.pointGet(this._mgr[t].pullPoint()),n?(console.log("del"),this._mgr.splice(t,1)):t++}this._mgr.length<2&&this.add(),console.log("score : ",e.score)}};var FieldLayer=cc.Layer.extend({_ship:null,_blockMgr:null,_winsize:null,_scoreLabel:null,ctor:function(){this._super()},init:function(){this._super(),_winsize=cc.director.getWinSize();cc.p(_winsize.width/2,_winsize.height/2);_blockMgr=new BlockMgr(_winsize.width,_winsize.height,this),_blockMgr.init(),_ship=new Ship,this.addChild(_ship),_scoreLabel=new cc.LabelTTF,_scoreLabel.setFontSize(20),_scoreLabel.setPosition(_winsize.width-45,_winsize.height-30),this.addChild(_scoreLabel),_scoreLabel.setString("score: "+_ship.getScore()),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouch},this),this.scheduleUpdate()},onTouch:function(){_ship.onTouch()},update:function(){_ship.y>_winsize.height&&_ship.gameOver(),_scoreLabel.removeFromParent(),_scoreLabel.setString("score: "+_ship.getScore()),this.addChild(_scoreLabel),_blockMgr.update(_ship)}}),GameLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t)}}),GameOverLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t);var n=new cc.MenuItemLabel(new cc.LabelTTF("restart","Arial",30),this.onPlay,this),c=new cc.MenuItemLabel(new cc.LabelTTF("ranking","Arial",30),this.onRanking,this);c.setPosition(0,-80);var r=new cc.Menu;r.addChild(n),r.addChild(c),r.setPosition(i),this.addChild(r);var s=new cc.LabelTTF;s.setFontSize(30),s.setPosition(e.width/2,e.height-150),s.setString("score: "+global_score),this.addChild(s)},onPlay:function(){cc.log("==onplay clicked"),cc.director.runScene(new GameScene)},onRanking:function(){cc.log("==onRanking clicked"),cc.director.runScene(new RankingScene)}}),GameOverScene=cc.Scene.extend({onEnter:function(){this._super();var e=new GameOverLayer;e.init(),this.addChild(e)}}),GameScene=cc.Scene.extend({onEnter:function(){this._super();var e=new GameLayer;e.init(),this.addChild(e,0);var i=new FieldLayer;i.init(),this.addChild(i,1)}});window.onload=function(){cc.game.onStart=function(){cc.LoaderScene.preload(g_resources,function(){cc.director.runScene(new MenuScene)},this)},cc.game.run("gameCanvas")};var MenuLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t);var n=new cc.MenuItemLabel(new cc.LabelTTF("start","Arial",30),this.onPlay,this),c=new cc.Menu;c.addChild(n),c.setPosition(i),this.addChild(c)},onPlay:function(){cc.log("==onplay clicked"),cc.director.runScene(new GameScene)}}),MenuScene=cc.Scene.extend({onEnter:function(){this._super();var e=new MenuLayer;e.init(),this.addChild(e)}}),RankingLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t);var n=new cc.MenuItemLabel(new cc.LabelTTF("return","Arial",30),this.onReturn,this),c=new cc.Menu;c.addChild(n),c.setPosition(e.width/2,e.height/6),this.addChild(c);var r=new cc.LabelTTF;r.setFontSize(30),r.setPosition(e.width/2,e.height-50),r.setString("Ranking"),this.addChild(r);for(var s=1;5>=s;s++){var o=new cc.LabelTTF;o.setFontSize(30),o.setPosition(e.width/2,e.height-70-50*s),o.setString(s+": playerName 500��"),this.addChild(o)}},onReturn:function(){cc.log("==return clicked"),cc.director.runScene(new GameOverScene)}}),RankingScene=cc.Scene.extend({onEnter:function(){this._super();var e=new RankingLayer;e.init(),this.addChild(e)}}),res={background:"res/background.png",chara:"res/chara.png"},g_resources=[res.background,res.chara],global_score=0,Ship=cc.Sprite.extend({appearPosition:cc.p(70,240),vy:4,ctor:function(){global_score=0,this.score=0,this._super(res.chara),this.setScale(.75,.75),this.x=this.appearPosition.x,this.y=this.appearPosition.y,this.scheduleUpdate()},update:function(){this.y>0?(this.y=this.y+this.vy,this.vy+=-.45):this.gameOver()},pointGet:function(e){this.score+=e},getScore:function(){return this.score/2},onTouch:function(){console.log("touch"),this.vy=7.5},gameOver:function(){global_score=this.score/2,cc.director.runScene(new GameOverScene)}});
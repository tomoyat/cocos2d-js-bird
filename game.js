function BlockMgr(e,i,t){this._winHeight=i,this._winWidth=e,this._layer=t,this._mgr=[]}var Block=cc.LayerColor.extend({ctor:function(e,i,t,n){return this._super(cc.color(255,0,0,255),t,n),this.x=e,this.y=i,this.width=t,!0},update:function(){return this.x-=2.8,this.x+this.width<0?(console.log("claen!"),this.removeFromParent(!0),!0):void 0}});BlockMgr.prototype={init:function(){this.add()},add:function(){var e=this._winHeight/7*2,i=this._winHeight/7*4,t=Math.random()*(i-e)+e,n=t+130,c=new Block(this._winWidth,0,30,t);this._mgr.push(c),this._layer.addChild(c),c=new Block(this._winWidth,n,30,this._winHeight-n),this._mgr.push(c),this._layer.addChild(c)},update:function(e){for(var i=e.getBoundingBox(),t=0;t<this._mgr.length;){console.log(this._mgr.length);var n=this._mgr[t].update(),c=this._mgr[t].getBoundingBox();cc.rectIntersectsRect(i,c)&&e.gameOver(),n?(console.log("del"),this._mgr.splice(t,1)):t++}this._mgr.length<2&&this.add()}};var FieldLayer=cc.Layer.extend({_ship:null,_blockMgr:null,ctor:function(){this._super()},init:function(){this._super();{var e=cc.director.getWinSize();cc.p(e.width/2,e.height/2)}_blockMgr=new BlockMgr(e.width,e.height,this),_blockMgr.init(),_ship=new Ship,this.addChild(_ship),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouch},this),this.scheduleUpdate()},onTouch:function(){_ship.onTouch()},update:function(){_blockMgr.update(_ship)}}),GameLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t)}}),GameOverLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t);var n=new cc.MenuItemLabel(new cc.LabelTTF("restart","Arial",30),this.onPlay,this),c=new cc.Menu;c.addChild(n),c.setPosition(i),this.addChild(c)},onPlay:function(){cc.log("==onplay clicked"),cc.director.runScene(new GameScene)}}),GameOverScene=cc.Scene.extend({onEnter:function(){this._super();var e=new GameOverLayer;e.init(),this.addChild(e)}}),GameScene=cc.Scene.extend({onEnter:function(){this._super();var e=new GameLayer;e.init(),this.addChild(e,0);var i=new FieldLayer;i.init(),this.addChild(i,1)}});window.onload=function(){cc.game.onStart=function(){cc.LoaderScene.preload(g_resources,function(){cc.director.runScene(new MenuScene)},this)},cc.game.run("gameCanvas")};var MenuLayer=cc.Layer.extend({ctor:function(){this._super()},init:function(){this._super();var e=cc.director.getWinSize(),i=cc.p(e.width/2,e.height/2),t=new cc.Sprite(res.background);t.setPosition(i),this.addChild(t);var n=new cc.MenuItemLabel(new cc.LabelTTF("start","Arial",30),this.onPlay,this),c=new cc.Menu;c.addChild(n),c.setPosition(i),this.addChild(c)},onPlay:function(){cc.log("==onplay clicked"),cc.director.runScene(new GameScene)}}),MenuScene=cc.Scene.extend({onEnter:function(){this._super();var e=new MenuLayer;e.init(),this.addChild(e)}}),res={background:"res/background.png",chara:"res/chara.png"},g_resources=[res.background,res.chara],Ship=cc.Sprite.extend({appearPosition:cc.p(160,240),vy:4,ctor:function(){this._super(res.chara),this.x=this.appearPosition.x,this.y=this.appearPosition.y,this.scheduleUpdate()},update:function(){this.y>0?(this.y=this.y+this.vy,this.vy+=-.25):this.gameOver()},onTouch:function(){console.log("touch"),this.vy=8},gameOver:function(){cc.director.runScene(new GameOverScene)}});